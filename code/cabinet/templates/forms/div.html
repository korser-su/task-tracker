{% if errors and not fields %}
    <div class="text-danger">{% for field in hidden_fields %}{{ field }}{% endfor %}</div>
{% else %}
    <div class="text-danger">{{ errors }}</div>
{% endif %}

{% for field, errors in fields %}
    <div class="mb-3">
        {% if field.use_fieldset %}
            <fieldset>
            {% if field.label %}{{ field.legend_tag }}{% endif %}
        {% endif %}
        {% if field.widget_type == 'checkbox' or field.widget_type == 'radio '%}
            <div class="form-check {% if field.widget_type == 'checkbox' %}form-switch{% endif %}">
                {{ field }}
                {% if field.label %}<label class="form-check-label" for="{{ field.auto_id }}">{{ field.label }}</label>{% endif %}
            </div>
        {% else %}
            {% if field.label %}<label class="form-label" for="{{ field.auto_id }}">{{ field.label }}</label>{% endif %}
            {{ field }}
        {% endif %}
        {% if field.help_text %}<div class="form-text">{{ field.help_text|safe }}</div>{% endif %}
        <div class="invalid-feedback">{{ errors }}</div>
        {% if field.use_fieldset %}</fieldset>{% endif %}
        {% if loop.last %}
            {% for field in hidden_fields %}{{ field }}{% endfor %}
        {% endif %}
    </div>
{% endfor %}
{% if not fields and not errors %}
    {% for field in hidden_fields %}{{ field }}{% endfor %}
{% endif %}
